<div class="container-fluid" ng-if="pages">
    <h1>
        <i class="{{page.icon}}"></i> {{page.name}}
        <button ng-if="session.type == 'Administrador'" class="btn btn-sm btn-primary" ng-click="showModal(page.fields)">
            <i class="glyphicon glyphicon-plus-sign"></i> 
            <span ng-if="page.collection != 'pagos'">Crear nuevo</span>
            <span ng-if="page.collection == 'pagos'">Cargar excel del mes</span>
        </button>
    </h1>
    <div class="form-group">
        <label class="sr-only" for="buscador"></label>
        <div class="input-group">
            <div class="input-group-addon"><span class="glyphicon glyphicon-search"></span></div>
            <input placeholder="Buscar aquí" type="text" class="form-control" ng-keyup="search()" ng-model="page.filter.value" id="buscador">
        </div>
    </div>
    <b class="text-primary" ng-if="registros">Mostrando {{registros}} registros.</b>

    <table class="table table-striped table-hover" ng-if="page.collection == 'pagos'">
        <thead>
            <tr>
                <th></th>
                <th>Titular</th>
                <th>RUT</th>
                <th>Dirección</th>
                <th>Numeración</th>
                <th>Tarifa sin IVA</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="items in uploaded_csv">
                <td class="text-danger">{{$index + 1}}</td>
                <td ng-repeat="(key,item) in items" ng-if="key != 'status'">
                    <span>{{item}}</span>
                </td>
                <td ng-repeat="(key,item) in items" ng-if="key == 'status'">
                    <select>
                        <option value="Pendiente">Pendiente</option>
                        <option value="Pagado">Pagado</option>
                        <option value="Revisar">Revisar</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>

    <table class="table table-striped table-hover" ng-if="page.collection != 'pagos'">
        <thead>
            <tr>
                <th></th>
                <th ng-repeat="field in page.fields" ng-if="field.title != '_id'">{{field.title}}</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="(index,trdata) in tabledata| startFrom: pagination.page * pagination.perPage | limitTo: pagination.perPage">
                <td><b class="text-danger">{{(index + 1) * (pagination.page + 1)}}</b></td>
                <td ng-repeat="(key,tddata) in trdata" ng-if="key != '_id'">
                    {{::tddata}}
                </td>
                <td ng-if="key == 'id'" ng-repeat="(key,tddata) in trdata">
                    <button class="btn btn-primary btn-xs" ng-click="openCommands(page.fields, trdata)">
                        <i class="glyphicon glyphicon-modal-window"></i> Comandos
                    </button>
                </td>
                <td ng-if="key == '_id' && session.type == 'Administrador'" ng-repeat="(key,tddata) in trdata">
                    <button class="btn btn-success btn-xs" ng-click="showModal(page.fields, trdata)"><i class="glyphicon glyphicon-edit"></i> Editar</button>
                    <button class="btn btn-danger btn-xs" ng-click="dropItem(page.fields, trdata)"><i class="glyphicon glyphicon-remove-circle"></i> Eliminar</button>
                </td>
            </tr>
        </tbody>
    </table>
    <nav class="text-center" ng-if="pagination.numPages > 1">
        <ul class="pagination">
            <li><a href="javascript:" ng-click="pagination.toPageId(0)"><i class="glyphicon glyphicon-fast-backward"></i></a></li>
            <li><a ng-hide="pagination.page == 0" href="javascript:" ng-click="pagination.prevPage()"><i class="glyphicon glyphicon-arrow-left"></i></a></li>
            <li ng-repeat="n in []| range: pagination.numPages" ng-class="{active: n == pagination.page}" ng-if="(pagination.page + 10) >= n && (pagination.page - 10) < n">
                <a href="javascript:" ng-click="pagination.toPageId(n)">{{n + 1}}</a>
            </li>
            <li><a ng-hide="pagination.page + 1 >= pagination.numPages" href="javascript:" ng-click="pagination.nextPage()"><i class="glyphicon glyphicon-arrow-right"></i></a></li>
            <li><a href="javascript:" ng-click="pagination.toPageId(pagination.numPages - 1)"><i class="glyphicon glyphicon-fast-forward"></i></a></li>
        </ul>
    </nav>
</div>